<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Quickjs (quickjs.Quickjs)</title><link rel="stylesheet" href="../../odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 1.5.2"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div class="content"><header><nav><a href="../index.html">Up</a> – <a href="../index.html">quickjs</a> &#x00BB; Quickjs</nav><h1>Module <code>Quickjs</code></h1><p>OCaml bindings to QuickJS.</p><dl><dt>see <a href="https://bellard.org/quickjs/quickjs.html">https://bellard.org/quickjs/quickjs.html</a></dt><dd></dd></dl><nav class="toc"><ul><li><a href="#type">type</a><ul><li><a href="#raw-represent">raw represent</a></li></ul></li><li><a href="#runtime">runtime</a></li><li><a href="#context">context</a></li><li><a href="#value">value</a></li><li><a href="#eval">eval</a></li></ul></nav></header><section><header><h2 id="type"><a href="#type" class="anchor"></a>type</h2></header><dl><dt class="spec type" id="type-runtime"><a href="#type-runtime" class="anchor"></a><code><span class="keyword">type</span> runtime</code></dt><dd><p><code>runtime</code> represents a Javascript runtime corresponding to an object heap. Several runtimes can exist at the same time but they cannot exchange objects. Inside a given runtime, no multi-threading is supported.</p></dd></dl><dl><dt class="spec type" id="type-context"><a href="#type-context" class="anchor"></a><code><span class="keyword">type</span> context</code></dt><dd><p><code>context</code> represents a Javascript context (or Realm). Each context has its own global objects and system objects. There can be several contexts per runtime and they can share objects, similar to frames of the same origin sharing Javascript objects in a web browser.</p></dd></dl><dl><dt class="spec type" id="type-value"><a href="#type-value" class="anchor"></a><code><span class="keyword">type</span> value</code></dt><dd><p><code>value</code> represents a Javascript value which can be a primitive type or an object.</p></dd></dl><dl><dt class="spec type" id="type-bytecode"><a href="#type-bytecode" class="anchor"></a><code><span class="keyword">type</span> bytecode</code></dt><dd><p><code>bytecode</code> represents the bytecode which is generated by <a href="index.html#val-compile"><code>compile</code></a> and can be executed with <a href="index.html#val-execute"><code>execute</code></a>.</p></dd></dl><dl><dt class="spec type" id="type-js_exn"><a href="#type-js_exn" class="anchor"></a><code><span class="keyword">type</span> js_exn</code><code> = <a href="index.html#type-value">value</a></code></dt><dd><p>JS can throw any <code>value</code></p></dd></dl><dl><dt class="spec type" id="type-or_js_exn"><a href="#type-or_js_exn" class="anchor"></a><code><span class="keyword">type</span> <span>'a or_js_exn</span></code><code> = <span><span>(<span class="type-var">'a</span>, <a href="index.html#type-js_exn">js_exn</a>)</span> Stdlib.result</span></code></dt></dl><section><header><h3 id="raw-represent"><a href="#raw-represent" class="anchor"></a>raw represent</h3></header><dl><dt class="spec value" id="val-get_raw_runtime"><a href="#val-get_raw_runtime" class="anchor"></a><code><span class="keyword">val</span> get_raw_runtime : <a href="index.html#type-runtime">runtime</a> <span>&#45;&gt;</span> <a href="../Quickjs_raw/index.html#type-js_runtime_ptr">Quickjs_raw.js_runtime_ptr</a></code></dt><dt class="spec value" id="val-get_raw_context"><a href="#val-get_raw_context" class="anchor"></a><code><span class="keyword">val</span> get_raw_context : <a href="index.html#type-context">context</a> <span>&#45;&gt;</span> <a href="../Quickjs_raw/index.html#type-js_context_ptr">Quickjs_raw.js_context_ptr</a></code></dt><dt class="spec value" id="val-get_raw_value"><a href="#val-get_raw_value" class="anchor"></a><code><span class="keyword">val</span> get_raw_value : <a href="index.html#type-value">value</a> <span>&#45;&gt;</span> <a href="../Quickjs_raw/index.html#type-js_value">Quickjs_raw.js_value</a></code></dt><dt class="spec value" id="val-get_raw_bytecode"><a href="#val-get_raw_bytecode" class="anchor"></a><code><span class="keyword">val</span> get_raw_bytecode : <a href="index.html#type-bytecode">bytecode</a> <span>&#45;&gt;</span> <a href="../Quickjs_raw/index.html#type-js_value">Quickjs_raw.js_value</a></code></dt></dl></section></section><section><header><h2 id="runtime"><a href="#runtime" class="anchor"></a>runtime</h2></header><dl><dt class="spec value" id="val-new_runtime"><a href="#val-new_runtime" class="anchor"></a><code><span class="keyword">val</span> new_runtime : unit <span>&#45;&gt;</span> <a href="index.html#type-runtime">runtime</a></code></dt><dt class="spec value" id="val-set_max_stack_size"><a href="#val-set_max_stack_size" class="anchor"></a><code><span class="keyword">val</span> set_max_stack_size : <a href="index.html#type-runtime">runtime</a> <span>&#45;&gt;</span> Unsigned.size_t <span>&#45;&gt;</span> unit</code></dt><dt class="spec value" id="val-set_memory_limit"><a href="#val-set_memory_limit" class="anchor"></a><code><span class="keyword">val</span> set_memory_limit : <a href="index.html#type-runtime">runtime</a> <span>&#45;&gt;</span> Unsigned.size_t <span>&#45;&gt;</span> unit</code></dt><dt class="spec value" id="val-set_gc_threshold"><a href="#val-set_gc_threshold" class="anchor"></a><code><span class="keyword">val</span> set_gc_threshold : <a href="index.html#type-runtime">runtime</a> <span>&#45;&gt;</span> Unsigned.size_t <span>&#45;&gt;</span> unit</code></dt><dt class="spec value" id="val-run_gc"><a href="#val-run_gc" class="anchor"></a><code><span class="keyword">val</span> run_gc : <a href="index.html#type-runtime">runtime</a> <span>&#45;&gt;</span> unit</code></dt><dt class="spec value" id="val-compute_memory_usage"><a href="#val-compute_memory_usage" class="anchor"></a><code><span class="keyword">val</span> compute_memory_usage : <a href="index.html#type-runtime">runtime</a> <span>&#45;&gt;</span> <a href="../Quickjs_raw/MemoryUsage/index.html#type-t">Quickjs_raw.MemoryUsage.t</a></code></dt><dt class="spec value" id="val-memory_usage_to_string"><a href="#val-memory_usage_to_string" class="anchor"></a><code><span class="keyword">val</span> memory_usage_to_string : <a href="../Quickjs_raw/MemoryUsage/index.html#type-t">Quickjs_raw.MemoryUsage.t</a> <span>&#45;&gt;</span> string</code></dt></dl><dl><dt class="spec type" id="type-interrupt_handler"><a href="#type-interrupt_handler" class="anchor"></a><code><span class="keyword">type</span> interrupt_handler</code><code> = <a href="index.html#type-runtime">runtime</a> <span>&#45;&gt;</span> bool</code></dt><dd><p><code>interrupt_handler runtime</code>, return false will interrupt runtime</p></dd></dl><dl><dt class="spec value" id="val-set_interrupt_handler"><a href="#val-set_interrupt_handler" class="anchor"></a><code><span class="keyword">val</span> set_interrupt_handler : <a href="index.html#type-runtime">runtime</a> <span>&#45;&gt;</span> <a href="index.html#type-interrupt_handler">interrupt_handler</a> <span>&#45;&gt;</span> unit</code></dt></dl></section><section><header><h2 id="context"><a href="#context" class="anchor"></a>context</h2></header><dl><dt class="spec value" id="val-new_context"><a href="#val-new_context" class="anchor"></a><code><span class="keyword">val</span> new_context : <a href="index.html#type-runtime">runtime</a> <span>&#45;&gt;</span> <a href="index.html#type-context">context</a></code></dt><dt class="spec value" id="val-get_runtime"><a href="#val-get_runtime" class="anchor"></a><code><span class="keyword">val</span> get_runtime : <a href="index.html#type-context">context</a> <span>&#45;&gt;</span> <a href="index.html#type-runtime">runtime</a></code></dt><dt class="spec value" id="val-enable_bignum_ext"><a href="#val-enable_bignum_ext" class="anchor"></a><code><span class="keyword">val</span> enable_bignum_ext : <a href="index.html#type-context">context</a> <span>&#45;&gt;</span> unit</code></dt><dd><p>enable math mode support.</p><dl><dt>see <a href="https://bellard.org/quickjs/jsbignum.html#Math-mode">https://bellard.org/quickjs/jsbignum.html#Math-mode</a></dt><dd></dd></dl></dd></dl><dl><dt class="spec value" id="val-disable_bignum_ext"><a href="#val-disable_bignum_ext" class="anchor"></a><code><span class="keyword">val</span> disable_bignum_ext : <a href="index.html#type-context">context</a> <span>&#45;&gt;</span> unit</code></dt></dl><dl><dt class="spec type" id="type-js_func"><a href="#type-js_func" class="anchor"></a><code><span class="keyword">type</span> js_func</code><code> = <a href="index.html#type-context">context</a> <span>&#45;&gt;</span> <a href="index.html#type-value">value</a> <span>&#45;&gt;</span> <span><a href="index.html#type-value">value</a> list</span> <span>&#45;&gt;</span> <a href="index.html#type-value">value</a></code></dt><dd><p><code>context -&gt; this -&gt; arguments</code></p></dd></dl><dl><dt class="spec value" id="val-add_func"><a href="#val-add_func" class="anchor"></a><code><span class="keyword">val</span> add_func : <a href="index.html#type-context">context</a> <span>&#45;&gt;</span> <a href="index.html#type-js_func">js_func</a> <span>&#45;&gt;</span> string <span>&#45;&gt;</span> int <span>&#45;&gt;</span> <span><a href="index.html#type-value">value</a> <a href="index.html#type-or_js_exn">or_js_exn</a></span></code></dt><dd><p><code>add_func context func name argc</code> export <code>func</code> to <code>context</code> return the js function created</p></dd></dl></section><section><header><h2 id="value"><a href="#value" class="anchor"></a>value</h2></header><dl><dt class="spec module" id="module-Value"><a href="#module-Value" class="anchor"></a><code><span class="keyword">module</span> <a href="Value/index.html">Value</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></dt><dd><p>convert <code>value</code> to ocaml data</p></dd></dl><dl><dt class="spec value" id="val-check_exception"><a href="#val-check_exception" class="anchor"></a><code><span class="keyword">val</span> check_exception : <a href="index.html#type-value">value</a> <span>&#45;&gt;</span> <span><a href="index.html#type-value">value</a> <a href="index.html#type-or_js_exn">or_js_exn</a></span></code></dt><dd><p><code>check_exception value</code> get exception obj from context. <b>Cannot be called twice with the same <code>value</code></b>.</p><pre><code class="ml">let _ =
  let open Quickjs in
  let r = eval_unsafe script in
  match check_exception r with
  | Ok obj -&gt; &quot;it is safe to use &quot; ^ (Value.to_string obj)
  | Error js_exn -&gt; &quot;eval_unsafe throw &quot; ^ (Value.to_string js_exn)</code></pre></dd></dl></section><section><header><h2 id="eval"><a href="#eval" class="anchor"></a>eval</h2></header><dl><dt class="spec type" id="type-eval_type"><a href="#type-eval_type" class="anchor"></a><code><span class="keyword">type</span> eval_type</code> = <code>[ </code><table class="variant"><tr id="type-eval_type.GLOBAL" class="anchored"><td class="def constructor"><a href="#type-eval_type.GLOBAL" class="anchor"></a><code>| </code><code>`GLOBAL</code></td><td class="doc"><p>global code (default)</p></td></tr><tr id="type-eval_type.MODULE" class="anchored"><td class="def constructor"><a href="#type-eval_type.MODULE" class="anchor"></a><code>| </code><code>`MODULE</code></td><td class="doc"><p>module code</p></td></tr></table><code> ]</code></dt><dt class="spec type" id="type-eval_flag"><a href="#type-eval_flag" class="anchor"></a><code><span class="keyword">type</span> eval_flag</code> = <code>[ </code><table class="variant"><tr id="type-eval_flag.STRICT" class="anchored"><td class="def constructor"><a href="#type-eval_flag.STRICT" class="anchor"></a><code>| </code><code>`STRICT</code></td><td class="doc"><p>force 'strict' mode</p></td></tr><tr id="type-eval_flag.STRIP" class="anchored"><td class="def constructor"><a href="#type-eval_flag.STRIP" class="anchor"></a><code>| </code><code>`STRIP</code></td><td class="doc"><p>force 'strip' mode</p></td></tr><tr id="type-eval_flag.BACKTRACE_BARRIER" class="anchored"><td class="def constructor"><a href="#type-eval_flag.BACKTRACE_BARRIER" class="anchor"></a><code>| </code><code>`BACKTRACE_BARRIER</code></td><td class="doc"><p>don't include the stack frames before this eval in the Error() backtraces</p></td></tr></table><code> ]</code></dt></dl><dl><dt class="spec value" id="val-eval"><a href="#val-eval" class="anchor"></a><code><span class="keyword">val</span> eval : <span>?&#8288;typ:<a href="index.html#type-eval_type">eval_type</a></span> <span>&#45;&gt;</span> <span>?&#8288;flags:<span><a href="index.html#type-eval_flag">eval_flag</a> list</span></span> <span>&#45;&gt;</span> <span>?&#8288;ctx:<a href="index.html#type-context">context</a></span> <span>&#45;&gt;</span> string <span>&#45;&gt;</span> <span><a href="index.html#type-value">value</a> <a href="index.html#type-or_js_exn">or_js_exn</a></span></code></dt><dd><p><code>eval ~typ ~flags ~ctx script</code></p></dd></dl><dl><dt class="spec value" id="val-eval_unsafe"><a href="#val-eval_unsafe" class="anchor"></a><code><span class="keyword">val</span> eval_unsafe : <span>?&#8288;typ:<a href="index.html#type-eval_type">eval_type</a></span> <span>&#45;&gt;</span> <span>?&#8288;flags:<span><a href="index.html#type-eval_flag">eval_flag</a> list</span></span> <span>&#45;&gt;</span> <span>?&#8288;ctx:<a href="index.html#type-context">context</a></span> <span>&#45;&gt;</span> string <span>&#45;&gt;</span> <a href="index.html#type-value">value</a></code></dt><dd><p><code>eval_unsafe ~typ ~flags ~ctx script</code>, you must check exception by yourself. <a href="index.html#val-check_exception"><code>check_exception</code></a></p></dd></dl><dl><dt class="spec value" id="val-compile"><a href="#val-compile" class="anchor"></a><code><span class="keyword">val</span> compile : <span>?&#8288;typ:<a href="index.html#type-eval_type">eval_type</a></span> <span>&#45;&gt;</span> <span>?&#8288;flags:<span><a href="index.html#type-eval_flag">eval_flag</a> list</span></span> <span>&#45;&gt;</span> <span>?&#8288;ctx:<a href="index.html#type-context">context</a></span> <span>&#45;&gt;</span> string <span>&#45;&gt;</span> <span><a href="index.html#type-bytecode">bytecode</a> <a href="index.html#type-or_js_exn">or_js_exn</a></span></code></dt><dd><p><code>compile ~typ ~flags ~ctx script</code></p></dd></dl><dl><dt class="spec value" id="val-execute"><a href="#val-execute" class="anchor"></a><code><span class="keyword">val</span> execute : <a href="index.html#type-bytecode">bytecode</a> <span>&#45;&gt;</span> <span><a href="index.html#type-value">value</a> <a href="index.html#type-or_js_exn">or_js_exn</a></span></code></dt><dd><p><code>execute bytecode</code></p></dd></dl></section></div></body></html>